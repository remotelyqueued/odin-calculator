<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="calculator" />

        <link rel="stylesheet" href="./styles/style.css" />

        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üôÖ</text></svg>"
        />
        <!-- 
            üï∂ üçî üëª ü§Ø üôÖ ü§£ üò≠ üëç
        -->
        <title>calcul never</title>
    </head>
    <body>
        <header>
            <h1>calcu eventually?</h1>
        </header>
        <main>
            <div id="history"></div>
            <div id="display"></div>

            <div id="keypad">
                <button type="button" data-action="ac">AC</button>
                <button type="button" data-action="operator">√∑</button>
                <button type="button" data-action="invert">+/-</button>
                <button type="button" data-action="back">‚Üê</button>

                <button type="button" data-action="number">7</button>
                <button type="button" data-action="number">8</button>
                <button type="button" data-action="number">9</button>
                <button type="button" data-action="operator">x</button>

                <button type="button" data-action="number">4</button>
                <button type="button" data-action="number">5</button>
                <button type="button" data-action="number">6</button>
                <button type="button" data-action="operator">-</button>

                <button type="button" data-action="number">1</button>
                <button type="button" data-action="number">2</button>
                <button type="button" data-action="number">3</button>
                <button type="button" data-action="operator">+</button>

                <button type="button" data-action="number">0</button>
                <button type="button" data-action="decimal">.</button>
                <button type="button" data-action="equals">=</button>
            </div>
        </main>
        <footer></footer>

        <script>
            // lol this is false isNaN('')
            class Calculator {
                constructor(elem, display) {
                    this.elem = elem;
                    this.display = display;

                    this.current = '';
                    this.previous = '';
                    this.op = '';

                    elem.onclick = this.onClick.bind(this);
                }

                number(innerText) {
                    // handles division by 0 
                    if (isNaN(this.current)) {
                        this.current = innerText;
                    } else {
                        this.current += innerText;
                    }
                }

                operator(innerText) {
                    // handles "" + ""
                    if (!this.current && !this.previous) return;
                    // handles . + .
                    if (isNaN(this.current)) return;
                    // handles ++++
                    if (!this.op.includes(innerText)) {
                        this.op = innerText;
                        this.previous += this.current;
                        this.current = '';
                    }
                }

                equals(event) {
                    // handles 3 = or 3 + =
                    if (!this.previous || !this.current) return;
                    this.compute();
                }

                compute() {
                    // division by 0
                    if (this.current === '0' && this.op === '√∑') {
                        this.previous = '';
                        this.op = '';
                        this.current = 'lol';
                    } else {
                        this.current = `${operate(
                            this.op,
                            parseFloat(this.previous),
                            parseFloat(this.current)
                        )}`;
                        this.previous = '';
                        this.op = '';
                    }
                }

                ac(innerText) {
                    this.display.innerText = '';
                    this.current = '';
                    this.previous = '';
                    this.op = '';
                }

                invert(event) {
                    // handles inverting an empty string lol
                    if (isNaN(parseFloat(this.current))) return;
                    this.current = `${operate(
                        'x',
                        parseFloat(this.current),
                        parseFloat('-1')
                    )}`;
                }

                back(event) {
                    if (this.current) {
                        this.current = this.current.slice(0, -1);
                        // handles - left in current after invert
                        if (this.current === '-') this.current = '';
                        // current and op are empty start removing previous
                    } else if (!this.current && !this.op) {
                        this.previous = this.previous.slice(0, -1);
                    } else if (!this.current) {
                        this.op = '';
                    }
                }

                decimal(event) {
                    // if decimal in current
                    if (this.current.includes('.')) return;
                    this.current += '.';
                }

                updateDisplay() {
                    if (this.previous) {
                        this.display.innerText = `${this.previous} ${this.op} ${this.current}`;
                    } else if (!this.previous && !this.current) {
                        this.display.innerText = '';
                        return;
                    } else if (!this.previous) {
                        this.display.innerText = `${this.current} ${this.op}`;
                    }
                }

                onKeyDown() {}
                onClick(event) {
                    let action = event.target.dataset.action;
                    if (action) {
                        this[action](event.target.innerText);
                        this.updateDisplay();

                        console.log(this);
                    }
                }
            }

            new Calculator(
                document.getElementById('keypad'),
                document.getElementById('display')
            );

            function operate(operator, num1, num2) {
                switch (operator) {
                    case '+':
                        return num1 + num2;
                    case '-':
                        return num1 - num2;
                    case 'x':
                        return num1 * num2;
                    case '√∑':
                        return num1 / num2;
                    default:
                        return operator;
                }
            }
        </script>
    </body>
</html>
