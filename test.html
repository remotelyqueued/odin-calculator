<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="calculator" />

        <link rel="stylesheet" href="./styles/style.css" />

        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëª</text></svg>"
        />
        <!-- 
            üï∂ üçî üëª ü§Ø üôÖ ü§£ üò≠ üëç
        -->
        <title>calculator</title>
    </head>
    <body>
        <header>
            <h1>calcu now</h1>
        </header>
        <main>
            <div id="history"></div>
            <div id="display"></div>

            <div id="keypad">
                <button type="button" data-action="clear">AC</button>
                <button type="button" data-action="divide">/</button>
                <button type="button" data-action="invert">+/-</button>
                <button type="button" data-action="back">‚Üê</button>

                <button type="button" data-action="number">7</button>
                <button type="button" data-action="number">8</button>
                <button type="button" data-action="number">9</button>
                <button type="button" data-action="multiply">*</button>

                <button type="button" data-action="number">4</button>
                <button type="button" data-action="number">5</button>
                <button type="button" data-action="number">6</button>
                <button type="button" data-action="subtract">-</button>

                <button type="button" data-action="number">1</button>
                <button type="button" data-action="number">2</button>
                <button type="button" data-action="number">3</button>
                <button type="button" data-action="add">+</button>

                <button type="button" data-action="number">0</button>
                <button type="button" data-action="decimal">.</button>

                <button type="button" data-action="equals">=</button>
            </div>
        </main>
        <footer></footer>

        <script>
            class Calculator {
                #elem;

                operator = '';
                operand = '';
                result = '';

                isFloat = false;

                display = document.getElementById('display');

                constructor(elem) {
                    this.#elem = elem;
                    elem.onclick = this.onClick.bind(this);
                }
                add() {
                    this.calculate('add');
                }
                subtract() {
                    this.calculate('subtract');
                }
                multiply() {
                    this.calculate('multiply');
                }
                divide() {
                    this.calculate('divide');
                }

                //
                calculate(operation) {
                    if (!operation) {
                        console.log('no operation. fail');
                        return;
                    } else if (!this.operand && !this.result) {
                        console.log('no operand and no result. double fail');
                        return;
                    }

                    this.operator = operation;

                    if (this.operand && this.result) {
                        this.result = `${operate(
                            this.operator,
                            parseFloat(this.result),
                            parseFloat(this.operand)
                        )}`;
                        this.operand = '';
                        // this.operator = '';
                        this.isFloat = false;
                    } else if (this.operand) {
                        this.result = this.operand;
                        this.operand = '';
                        this.isFloat = false;
                    }

                    if (!isFinite(this.result)) {
                        console.log('lmao. shit went wrong');
                        console.log(this.result);
                        this.clear();
                    }
                }

                equals() {
                    this.calculate(this.operator);
                    this.operator = ''; // keep pressing equals need for display
                }

                clear() {
                    this.operator = '';
                    this.operand = '';
                    this.result = '';
                    this.isFloat = false;
                    console.log('cleared');
                }

                invert() {
                    if (!this.operand && this.result) {
                        this.result = `${operate(
                            'multiply',
                            parseFloat(this.result),
                            -1
                        )}`;
                    } else if (!this.operand && !this.result) {
                        return;
                    } else {
                        this.operand = `${operate(
                            'multiply',
                            parseFloat(this.operand),
                            -1
                        )}`;
                    }
                }

                // todo: floating point math
                decimal() {
                    if (this.isFloat) {
                        return;
                    } else {
                        this.operand += '.';
                        this.isFloat = true;
                    }
                }

                // ‚úîÔ∏è
                back() {
                    if (this.operand) {
                        this.operand = this.operand.slice(0, -1);
                        if (this.operand.length == 0) {
                            this.isFloat = false;
                        }
                    } else if (this.operator) {
                        this.operator = '';
                    } else {
                        this.result = this.result.slice(0, -1);
                    }
                }

                // ‚úîÔ∏è
                number(event) {
                    this.operand += event.target.innerText;
                }

                // ‚úîÔ∏è
                onClick(event) {
                    let action = event.target.dataset.action;
                    if (action) {
                        this[action](event);
                        this.updateDisplay();
                    }
                }

                // todo: result on screen - start entering decimal it
                // appears but does not effect correctness
                updateDisplay() {
                    console.log(this);
                    if (!this.result) {
                        this.display.innerText = `${this.operand}`;
                    } else if (!this.operator) {
                        if (this.result && this.operand) {
                            this.display.innerText = `${this.operand}`;
                        } else {
                            this.display.innerText = `${this.result}`;
                        }
                    } else {
                        // if (this.isFloat) {
                        //     this.display.innerText = `${this.operand}`;
                        // } else {

                        this.display.innerText = `${
                            this.result + this.operatorToSymbol() + this.operand
                        }`;
                        // }
                    }
                }

                // todo:
                updateHistory() {}
                onKeyDown() {}

                operatorToSymbol() {
                    switch (this.operator) {
                        case 'add':
                            return '+';
                        case 'subtract':
                            return '-';
                        case 'multiply':
                            return '*';
                        case 'divide':
                            return '/';
                        default:
                            return '';
                    }
                }
            }

            new Calculator(keypad);

            function operate(operator, num1, num2) {
                switch (operator) {
                    case 'add':
                        return add(num1, num2);
                    case 'subtract':
                        return subtract(num1, num2);
                    case 'multiply':
                        return multiply(num1, num2);
                    case 'divide':
                        return divide(num1, num2);
                    default:
                        return 'Oops';
                }
            }

            function add(x, y) {
                return x + y;
            }

            function subtract(x, y) {
                return x - y;
            }

            function multiply(x, y) {
                return x * y;
            }

            function divide(x, y) {
                return x / y;
            }
        </script>
    </body>
</html>
