<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="calculator" />

        <link rel="stylesheet" href="./styles/style.css" />

        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘»</text></svg>"
        />
        <!-- 
            ðŸ•¶ ðŸ” ðŸ‘» ðŸ¤¯ ðŸ™… ðŸ¤£ ðŸ˜­ ðŸ‘
        -->
        <title>calculator</title>
    </head>
    <body>
        <header>
            <h1>calculator</h1>
        </header>
        <main>
            <div id="history"></div>
            <div id="display"></div>

            <div id="keypad">
                <button type="button" data-action="clear">C</button>
                <button type="button" data-action="add">+</button>
                <button type="button" data-action="subtract">-</button>
                <button type="button" data-action="multiply">*</button>
                <button type="button" data-action="divide">/</button>
                <button type="button" data-action="equals">=</button>
                <button type="button" data-action="invert">+/-</button>
                <button type="button" data-action="decimal">.</button>
                <button type="button" data-action="back">back</button>

                <button type="button" data-action="number">1</button>
                <button type="button" data-action="number">2</button>
                <button type="button" data-action="number">3</button>
                <button type="button" data-action="number">4</button>
                <button type="button" data-action="number">5</button>
                <button type="button" data-action="number">6</button>
                <button type="button" data-action="number">7</button>
                <button type="button" data-action="number">8</button>
                <button type="button" data-action="number">9</button>
                <button type="button" data-action="number">0</button>
            </div>
        </main>
        <footer></footer>

        <script>
            class Calculator {
                #elem;
                _operator = '';
                _operand = '';
                _result = '';
                _isFloat = false;

                constructor(elem) {
                    this.#elem = elem;
                    elem.onclick = this.onClick.bind(this);
                }
                add() {
                    this._calculate('add');
                }
                subtract() {
                    this._calculate('subtract');
                }
                multiply() {
                    this._calculate('multiply');
                }
                divide() {
                    this._calculate('divide');
                }

                // are true
                // operation && operand && result
                // operation && result
                // operation && operand

                // todo: fix logic
                _calculate(operation) {
                    if (!operation) {
                        console.log('no operation. fail');
                        return;
                    } else if (!this._operand && !this._result) {
                        console.log('no operand and no result. double fail');
                        return;
                    }

                    this._operator = operation;

                    if (this._operand && this._result) {
                        this._result = `${operate(
                            this._operator,
                            parseFloat(this._result),
                            parseFloat(this._operand)
                        )}`;
                        this._operand = '';
                        this._isFloat = false;
                    } else if (this._operand) {
                        this._result = this._operand;
                        this._operand = '';
                        this._isFloat = false;
                    } else if (this._result) {
                        // ... just change operator
                    }

                    
                    console.log(this.toString());

                    if (!isFinite(this._result)) {
                        console.log('lmao');
                        this.clear();
                    }
                }
                equals() {
                    this._calculate(this._operator);
                }
                clear() {
                    this._operator = '';
                    this._operand = '';
                    this._result = '';
                    this._isFloat = false;
                    console.log('cleared');
                }
                invert() {
                    if (!this._operand) {
                        console.log('so much failing');
                    } else {
                        this._operand = `${operate(
                            'multiply',
                            parseFloat(this._operand),
                            -1
                        )}`;
                    }
                }
                decimal() {
                    if (this._isFloat) {
                        console.log('failing');
                    } else if (!this._operand) {
                        console.log('more failing');
                    } else {
                        this._operand += '.';
                        this._isFloat = true;
                    }
                }
                back() {
                    if (!this._operand) {
                        console.log('u are failur');
                    } else {
                        this._operand = this._operand.slice(0, -1);
                    }
                }

                number(event) {
                    if (this._operand.length > 10) {
                        console.log('OOps');
                    } else {
                        this._operand += event.target.innerText;
                        console.log(this._operand);
                    }
                }

                onClick(event) {
                    let action = event.target.dataset.action;
                    if (action) {
                        this[action](event);
                    }
                }

                toString() {
                    return `${this._operand} ${this._operator} ${this._result}`;
                }
            }

            new Calculator(keypad);

            function operate(operator, num1, num2) {
                switch (operator) {
                    case 'add':
                        return add(num1, num2);
                    case 'subtract':
                        return subtract(num1, num2);
                    case 'multiply':
                        return multiply(num1, num2);
                    case 'divide':
                        return divide(num1, num2);
                    default:
                        return 'Oops';
                }
            }

            function add(x, y) {
                return x + y;
            }

            function subtract(x, y) {
                return x - y;
            }

            function multiply(x, y) {
                return x * y;
            }

            function divide(x, y) {
                return x / y;
            }
        </script>
    </body>
</html>
