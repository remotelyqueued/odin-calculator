<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="calculator" />

        <link rel="stylesheet" href="./styles/style.css" />

        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëª</text></svg>"
        />
        <!-- 
            üï∂ üçî üëª ü§Ø üôÖ ü§£ üò≠ üëç
        -->
        <title>calculator</title>
    </head>
    <body>
        <header>
            <h1>calcu now</h1>
        </header>
        <main>
            <div id="history"></div>
            <div id="display"></div>

            <div id="keypad">
                <button type="button" data-action="allClear">AC</button>
                <button type="button" data-action="divide">/</button>
                <button type="button" data-action="invert">+/-</button>
                <button type="button" data-action="back">‚Üê</button>

                <button type="button" data-action="number">7</button>
                <button type="button" data-action="number">8</button>
                <button type="button" data-action="number">9</button>
                <button type="button" data-action="multiply">*</button>

                <button type="button" data-action="number">4</button>
                <button type="button" data-action="number">5</button>
                <button type="button" data-action="number">6</button>
                <button type="button" data-action="subtract">-</button>

                <button type="button" data-action="number">1</button>
                <button type="button" data-action="number">2</button>
                <button type="button" data-action="number">3</button>
                <button type="button" data-action="add">+</button>

                <button type="button" data-action="number">0</button>
                <button type="button" data-action="decimal">.</button>

                <button type="button" data-action="equals">=</button>
            </div>
        </main>
        <footer></footer>

        <script>
            class Calculator {
                #elem = null;
                #display = null;

                operator = '';
                operand = '';
                result = '';

                onScreen = '';

                previous = '';

                constructor(elem, display) {
                    this.#elem = elem;
                    this.#display = display;
                    elem.onclick = this.onClick.bind(this);
                }

                add() {
                    this.calculate('add');
                }
                subtract() {
                    this.calculate('subtract');
                }
                multiply() {
                    this.calculate('multiply');
                }
                divide() {
                    this.calculate('divide');
                }

                calculate(operation, action) {
                    if (!operation) {
                        console.log('no operation');
                        return;
                    } else if (!this.operand && !this.result) {
                        console.log('no operand and no result');
                        return;
                    }

                    this.operator = operation;

                    if (this.operand && this.result) {
                        this.result = `${operate(
                            this.operator,
                            parseFloat(this.result),
                            parseFloat(this.operand)
                        )}`;
                        this.previous = this.operand;
                        this.operand = '';
                    } else if (this.operand) {
                        this.result = this.operand;
                        this.operand = '';
                    } else if (action === 'equals') {
                        console.log('in this previous');
                        this.result = `${operate(
                            this.operator,
                            parseFloat(this.result),
                            parseFloat(this.previous)
                        )}`;
                    }

                    if (!isFinite(this.result)) {
                        console.log(this.result);
                    }
                }

                onClick(event) {
                    let action = event.target.dataset.action;
                    if (action) {
                        this[action](event);
                        this.updateDisplay(action);
                        console.log(this);
                    }
                }

                equals(action) {
                    this.calculate(this.operator, action);
                }

                allClear() {
                    this.operator = '';
                    this.operand = '';
                    this.result = '';
                    this.#display.innerText = '';
                }

                invert() {
                    if (!this.operand && !this.result) {
                        return;
                    } else if (!this.operand) {
                        this.result = `${operate(
                            'multiply',
                            parseFloat(this.result),
                            -1
                        )}`;
                    } else {
                        this.operand = `${operate(
                            'multiply',
                            parseFloat(this.operand),
                            -1
                        )}`;
                    }
                }

                back() {
                    if (this.result) {
                        this.result = this.result.slice(0, -1);
                    } else if (this.operator) {
                        this.operand = this.operand.slice(0, -1);
                        this.operator = '';
                    } else {
                        
                    }
                }

                decimal() {
                    if (!this.operand.includes('.')) {
                        this.operand += '.';
                    }
                }

                number(event) {
                    this.operand += event.target.innerText;
                }

                // lol kind of a mess
                updateDisplay(action) {
                    if (action === 'equals' && this.result) {
                        this.#display.innerText = this.result;
                        this.onScreen = 'result';
                    } else if (this.operand && !this.result && !this.operator) {
                        this.#display.innerText = this.operand;
                    } else {
                        this.#display.innerText = `${
                            this.result
                        } ${this.operatorToSymbol()} ${this.operand}`;
                    }
                }

                operatorToSymbol() {
                    switch (this.operator) {
                        case 'add':
                            return '+';
                        case 'subtract':
                            return '-';
                        case 'multiply':
                            return '*';
                        case 'divide':
                            return '/';
                        default:
                            return '';
                    }
                }

                // todo:
                updateHistory() {}
                onKeyDown() {}
            }

            new Calculator(
                document.getElementById('keypad'),
                document.getElementById('display')
            );

            function operate(operator, num1, num2) {
                switch (operator) {
                    case 'add':
                        return num1 + num2;
                    case 'subtract':
                        return num1 - num2;
                    case 'multiply':
                        return num1 * num2;
                    case 'divide':
                        return num1 / num2;
                    default:
                        return 'Oops';
                }
            }
        </script>
    </body>
</html>
