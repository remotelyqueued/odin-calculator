<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="calculator" />

        <link rel="stylesheet" href="./styles/style.css" />

        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üôÖ</text></svg>"
        />
        <!-- 
            üï∂ üçî üëª ü§Ø üôÖ ü§£ üò≠ üëç
        -->
        <title>calculator</title>
    </head>
    <body>
        <header>
            <h1>calcu eventually</h1>
        </header>
        <main>
            <div id="history"></div>
            <div id="display"></div>

            <div id="keypad">
                <button type="button" data-action="ac">AC</button>
                <button type="button" data-action="operator">√∑</button>
                <button type="button" data-action="invert">+/-</button>
                <button type="button" data-action="back">‚Üê</button>

                <button type="button" data-action="number">7</button>
                <button type="button" data-action="number">8</button>
                <button type="button" data-action="number">9</button>
                <button type="button" data-action="operator">x</button>

                <button type="button" data-action="number">4</button>
                <button type="button" data-action="number">5</button>
                <button type="button" data-action="number">6</button>
                <button type="button" data-action="operator">-</button>

                <button type="button" data-action="number">1</button>
                <button type="button" data-action="number">2</button>
                <button type="button" data-action="number">3</button>
                <button type="button" data-action="operator">+</button>

                <button type="button" data-action="number">0</button>
                <button type="button" data-action="decimal">.</button>
                <button type="button" data-action="equals">=</button>
            </div>
        </main>
        <footer></footer>

        <script>
            class Calculator {
                constructor(elem, display) {
                    this.elem = elem;
                    this.display = display;
                    this.current = [];
                    this.result = '';

                    this.re = /[\√∑\+\-\x]/g;
                    this.previous = '';

                    this.op = '';
                    elem.onclick = this.onClick.bind(this);
                }
                // handlers
                number(innerText) {
                    this.current.push(innerText);
                }
                // +, -, √∑, x
                operator(innerText) {
                    this.op = innerText;
                    let lastItem = this.current.at(-1);

                    

                    if (isNaN(lastItem) ) {
                        this.current.splice(-1, 1, innerText);
                    } else {
                        this.current.push(this.op);
                    }

                    // if (this.current.includes(innerText)) {
                    //     return;
                    // } else {
                    //     this.op = innerText;

                    // this.op = innerText;
                    // this.current.splice(-1, 1, innerText);

                    // this.op = innerText;
                    // let lastItem = this.current.at(-1);

                    // if (this.op === innerText) {
                    //     this.current.push(this.op);
                    // } else {
                    //     this.op = innerText;
                    //     this.current.push(this.op);

                    // }

                    // this.current.
                    // this.op = innerText;

                    // this.current.push(this.op);
                    // if (this.op === innerText) {
                    //     return;
                    // } else {
                    //     this.current.splice(-1, 1, innerText);

                    //     this.current.push(innerText);
                    // }
                    // this.op = innerText;
                    // }
                }

                equals(event) {
                    this.compute();
                }

                compute() {
                    if (this.current.length && this.op) {
                        if (!this.previous) {
                            let index = this.current.findIndex(
                                e => e === this.op
                            );
                            let num1 = this.current.slice(0, index).join('');

                            this.previous = this.current
                                .slice(index + 1)
                                .join('');

                            this.result = `${operate(
                                this.op,
                                parseFloat(num1),
                                parseFloat(this.previous)
                            )}`;
                        } else {
                            this.result = `${operate(
                                this.op,
                                parseFloat(this.result),
                                parseFloat(this.previous)
                            )}`;
                        }
                        this.current = [...this.result];
                    }
                }

                ac(innerText) {
                    this.current = [];
                    this.display.innerText = '';
                    this.result = '';
                    this.op = '';
                    this.previous = '';
                }

                invert(event) {}
                back(event) {
                    if (this.current) {
                        let lastItem = this.current.pop();
                        if (lastItem === this.op) this.op = '';
                    }
                }

                decimal(event) {}

                // helpers
                updateDisplay() {
                    this.display.innerText = this.current.join('');
                }

                // initial handler
                onKeyDown() {}

                onClick(event) {
                    let action = event.target.dataset.action;
                    if (action) {
                        this[action](event.target.innerText);
                        this.updateDisplay();
                        console.log(this);
                    }
                }

                toString() {
                    return this.current.join().toLocaleString();
                }
            }

            new Calculator(
                document.getElementById('keypad'),
                document.getElementById('display')
            );

            function operate(operator, num1, num2) {
                switch (operator) {
                    case '+':
                        return num1 + num2;
                    case '-':
                        return num1 - num2;
                    case 'x':
                        return num1 * num2;
                    case '√∑':
                        return num1 / num2;
                    default:
                        return 'Oops';
                }
            }
        </script>
    </body>
</html>
